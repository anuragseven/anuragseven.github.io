---
import BaseLayout from '../../layouts/BaseLayout.astro';
import BlogFilter from '../../components/BlogFilter';
import { getCollection } from 'astro:content';

const posts = await getCollection('blog', ({ data }) => !data.draft);
const sortedPosts = posts.sort((a, b) =>
  new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

// Prepare posts data for the client component
const postsData = sortedPosts.map(post => ({
  title: post.data.title,
  date: post.data.date.toISOString(),
  category: post.data.category,
  excerpt: post.data.excerpt,
  slug: post.slug
}));

// Get unique categories
const categories = [...new Set(posts.map(p => p.data.category))];
---

<BaseLayout title="Blog" description="Technical articles and tutorials">
  <section class="container mx-auto px-4 py-16">
    <h1 class="text-4xl font-bold mb-4">Blog</h1>
    <p class="text-[var(--text-muted)] mb-8 max-w-2xl">
      Technical articles, tutorials, and thoughts on software engineering.
    </p>

    <BlogFilter client:load posts={postsData} categories={categories} />
  </section>
</BaseLayout>
